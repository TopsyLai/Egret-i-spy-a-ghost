var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r},__awaiter=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(a,n){function o(t){try{h(i.next(t))}catch(e){n(e)}}function s(t){try{h(i["throw"](t))}catch(e){n(e)}}function h(t){t.done?a(t.value):new r(function(e){e(t.value)}).then(o,s)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function r(t){return function(e){return i([t,e])}}function i(r){if(a)throw new TypeError("Generator is already executing.");for(;h;)try{if(a=1,n&&(o=n[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return h.label++,{value:r[1],done:!1};case 5:h.label++,n=r[1],r=[0];continue;case 7:r=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){h=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){h.label=r[1];break}if(6===r[0]&&h.label<o[1]){h.label=o[1],o=r;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(r);break}o[2]&&h.ops.pop(),h.trys.pop();continue}r=e.call(t,h)}catch(i){r=[6,i],n=0}finally{a=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var a,n,o,s,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},qr;!function(t){var e=function(){function e(e){this.mode=t.QRMode.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var r=0,i=this.data.length;i>r;r++){var a=[],n=this.data.charCodeAt(r);n>65536?(a[0]=240|(1835008&n)>>>18,a[1]=128|(258048&n)>>>12,a[2]=128|(4032&n)>>>6,a[3]=128|63&n):n>2048?(a[0]=224|(61440&n)>>>12,a[1]=128|(4032&n)>>>6,a[2]=128|63&n):n>128?(a[0]=192|(1984&n)>>>6,a[1]=128|63&n):a[0]=n,this.parsedData.push(a)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}return e.prototype.getLength=function(t){return this.parsedData.length},e.prototype.write=function(t){for(var e=0,r=this.parsedData.length;r>e;e++)t.put(this.parsedData[e],8)},e}();t.QR8bitByte=e,__reflect(e.prototype,"qr.QR8bitByte")}(qr||(qr={}));var GameConst=function(){function t(){}return t}();__reflect(GameConst.prototype,"GameConst");var Gameplay=function(t){function e(){var e=t.call(this)||this;return e.vj=new VirtualJoystick,e.roomArray=[],e.gameScale=.5,e.worldMoveSpeed=-1,e.decorationOffset={},e.leftOrRight=!1,e.roomWidth=220,e.roomHeight=200,e.levelHeights=[],e.dropArray=[],e.readyCounter=180,e.createView(),e.addEventListener(egret.Event.ENTER_FRAME,function(){e.update()},e),Window.CurrentStage.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){var r=t.localX*(1/e.gameScale),i=t.localY*(1/e.gameScale);e.ghost.pressed=!0,e.SendTargetData(r,i)},e),e}return __extends(e,t),e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,r=RES.getRes(t);return e.texture=r,e},e.prototype.roundRandom=function(t,e){return Math.round(Math.random()*(e-t))+t},e.prototype.checkOverlap=function(t,e){var r=t.getBounds(),i=e.getBounds();return r.intersects(i)},e.prototype.CreateDrop=function(t,e,r){var i=["Anvil","Crate","Safe"];null==r&&(r=i[Math.floor(Math.random()*i.length)]);var a=this.createBitmapByName(r);return this.addChild(a),a.x=t,a.y=e,a.asset=r,a.speedY=0,a.z=200,this.dropArray.push(a),a},e.prototype.CreateRoom=function(t,e,r,i,a){var n={deco:[],pieces:[],floor:[]};n.pieces=[],n.floor=[],n.deco=[];var o=r;if(0==r){var s=this.createBitmapByName("Wall_"+i+"_Single");this.roomContainer.addChild(s),s.x=t,s.y=e,n.pieces.push(s)}else{r-=1;var h=this.createBitmapByName("Wall_"+i+"_Left");this.roomContainer.addChild(h),h.x=t,h.y=e,n.pieces.push(h);for(var l=1;r+1>l;l++){var d=this.createBitmapByName("Wall_"+i+"_Center");this.roomContainer.addChild(d),d.x=t+l*n.pieces[0].width,d.y=e,n.pieces.push(d)}var c=this.createBitmapByName("Wall_"+i+"_Right");this.roomContainer.addChild(c),c.x=t+n.pieces[0].width*(r+1),c.y=e,n.pieces.push(c)}for(var l=0;l<n.pieces.length;l++){var p=n.pieces[l];p.z=-10,p.anchorOffsetX=.5,p.anchorOffsetY=.5;var u=this.createBitmapByName("Floor_Center");if(this.roomContainer.addChild(u),u.x=p.x,u.y=p.y+p.height/2-5,n.floor.push(u),u.anchorOffsetX=.5,u.anchorOffsetY=.5,null==a&&Math.random()<.5){var g={};g.Attic=7,g.Middle=11,g.Basement=4;var f=i+"_deco_"+this.roundRandom(1,g[i]),y=this.createBitmapByName(f);this.roomContainer.addChild(y),y.blendMode=egret.BlendMode.NORMAL,y.anchorOffsetX=.5,y.anchorOffsetY=.5,n.deco.push(y),y.x=p.x,y.y=p.y,y.y+=u.y-(y.y+y.height),y.z=-5,y.asset=f,this.decorationOffset[f]&&(y.y+=this.decorationOffset[f]),"Middle_deco_2"==f&&(y.scaleX=.8,y.scaleY=.8)}}if(a)for(var l=0;l<a.length;l++){var w=a[l],y=this.createBitmapByName(w.asset);this.roomContainer.addChild(y),y.blendMode=egret.BlendMode.NORMAL,y.x=w.x,y.y=w.y,y.z=-5,y.scaleX=w.scaleX,y.scaleY=w.scaleY,y.anchorOffsetX=.5,y.anchorOffsetY=.5,n.deco.push(y)}if(this.roomArray.push(n),"people"==window.playerType&&window.ConnObject){for(var m=[],l=0;l<n.deco.length;l++){var v={x:"",y:"",asset:"",scaleX:"",scaleY:""};v.x=n.deco[l].x,v.y=n.deco[l].y,v.asset=n.deco[l].asset,v.scaleX=n.deco[l].scaleX,v.scaleY=n.deco[l].scaleY,m.push(v)}window.ConnObject.send({meta:"p_room",x:t,y:e,width:o,level:i,decoArray:m,is_p_room:!0})}},e.prototype.FloorCollision=function(t){for(var e=0;e<this.roomArray.length;e++)for(var r=this.roomArray[e],i=0;i<r.floor.length;i++){var a=r.floor[i],n=a.x-this.player.x+this.player.width;if(Math.abs(n)<a.width/2&&this.player.speedY>0)for(var o=a.y-this.player.y;o>110&&130>o;)this.player.y--,o=a.y-this.player.y,this.player.speedY=0,"jumping"==this.player.state&&(this.player.state="idle")}},e.prototype.createView=function(){var t=this;this.bgContainer=new egret.DisplayObjectContainer,this.roomContainer=new egret.DisplayObjectContainer,this.topsyContainer=new egret.DisplayObjectContainer,this.decoContainer=new egret.DisplayObjectContainer,this.addChild(this.bgContainer),this.addChild(this.roomContainer),this.addChild(this.topsyContainer),this.addChild(this.decoContainer);var e=new egret.Shape;new egret.Matrix;if(e.graphics.beginFill(1183260,1),e.graphics.drawRect(0,0,Window.CurrentStage.stage.stageWidth*(1/this.gameScale),Window.CurrentStage.stage.stageHeight*(1/this.gameScale)),e.graphics.endFill(),this.bgContainer.addChild(e),this.decorationOffset.Attic_deco_7=-50,this.decorationOffset.Middle_deco_3=-50,this.decorationOffset.Middle_deco_11=-50,this.decorationOffset.Middle_deco_10=-50,this.decorationOffset.Middle_deco_9=-50,this.decorationOffset.Middle_deco_8=-50,this.decorationOffset.Middle_deco_2=-20,this.decorationOffset.Middle_deco_5=-20,this.decorationOffset.Basement_deco_3=-20,this.levelHeights[0]=200,this.levelHeights[1]=this.roomHeight+this.levelHeights[0]+20,this.levelHeights[2]=2*this.roomHeight+this.levelHeights[0]+40,this.levelHeights[3]=3*this.roomHeight+this.levelHeights[0]+60,this.readyCounter=180,this.ghost=this.createBitmapByName("ghost_float1"),this.topsyContainer.addChild(this.ghost),this.ghost.x=.5*Window.CurrentStage.stage.stageWidth-this.ghost.width/2,this.ghost.y=.5*Window.CurrentStage.stage.stageHeight-this.ghost.height/2,this.ghost.frameNum=1,this.ghost.counter=0,this.ghost.z=10,this.ghost.anchorOffsetX=.5,this.ghost.anchorOffsetY=.5,this.player=this.createBitmapByName("kid_idle"),this.topsyContainer.addChild(this.player),this.player.x=.5*Window.CurrentStage.stage.stageWidth-this.player.width/2,this.player.y=0,this.player.speedY=0,this.player.speedX=0,this.player.state="idle",this.player.slip=0,this.player.broadcastCount=0,this.player.broadcastTime=90,this.player.frameNum=1,this.player.frameTitle="idle",this.player.frameCounts={},this.player.frameCounts.idle=1,this.player.frameCounts.run=8,this.player.counter=0,this.player.lanternCount=0,this.player.attachedLantern=this.createBitmapByName("lantern_active"),this.bgContainer.addChild(this.player.attachedLantern),this.player.attachedLantern.alpha=0,this.player.attachedLantern.anchorOffsetX=.5,this.player.attachedLantern.anchorOffsetY=.5,this.player.glow=this.createBitmapByName("lantern_glow"),this.decoContainer.addChild(this.player.glow),this.player.glow.anchorOffsetX=.5,this.player.glow.anchorOffsetY=.5,this.player.glow.z=5e5,this.player.glow.blendMode=egret.BlendMode.ADD,this.blackness=this.createBitmapByName("black"),this.decoContainer.addChild(this.blackness),this.blackness.x=0,this.blackness.y=0,this.blackness.anchorOffsetX=.5,this.blackness.anchorOffsetY=.5,this.blackness.alpha=.1,this.blackness.scaleX=3,this.blackness.scaleY=3,this.blackness.z=9999999,this.creditText=new egret.TextField,this.creditText.text="Created by Omar Shehata (@Omar4ur) & tak (@takorii) \n reconsitution by Topsy(@TopsyLai) ",this.creditText.x=.5*Window.CurrentStage.stage.stageWidth*(1/this.gameScale)-this.creditText.width/2,this.creditText.textColor="0xffffff",this.creditText.y=.5*Window.CurrentStage.stage.stageHeight*(1/this.gameScale)*2-this.creditText.height-50,this.creditText.z=this.blackness.z+1,this.creditText.textAlign="center",this.decoContainer.addChild(this.creditText),this.iSPY=this.createBitmapByName("title_ispy"),this.decoContainer.addChild(this.iSPY),this.iSPY.x=Window.CurrentStage.stage.stageWidth/2*(1/this.gameScale)-this.iSPY.width/2,this.iSPY.y=Window.CurrentStage.stage.stageHeight/2,this.iSPY.z=this.creditText.z,this.countdownGraphic=this.createBitmapByName("countdown_3"),this.decoContainer.addChild(this.countdownGraphic),this.countdownGraphic.anchorOffsetX=.5,this.countdownGraphic.anchorOffsetY=.5,this.countdownGraphic.z=this.creditText.z,this.countdownGraphic.y+=this.countdownGraphic.height+3*this.iSPY.height,this.countdownGraphic.x+=Window.CurrentStage.stage.stageWidth/2*(1/this.gameScale)-this.countdownGraphic.width/2,this.player.z=10,this.player.anchorOffsetX=.5,this.player.anchorOffsetY=.5,"ghost"==window.playerType&&(this.iTitle=this.createBitmapByName("title_thief"),this.decoContainer.addChild(this.iTitle),this.iTitle.x=this.iSPY.x,this.iTitle.y=this.iSPY.y+this.iTitle.height+30,this.ghost.glowCount=0,this.ghost.x=Math.random()*(1/this.gameScale)*Window.CurrentStage.stage.stageWidth,this.ghost.y=Math.random()*(1/this.gameScale)*Window.CurrentStage.stage.stageHeight),"people"==window.playerType){this.childrenCreated(),this.iTitle=this.createBitmapByName("title_ghost"),this.decoContainer.addChild(this.iTitle),this.iTitle.x=this.iSPY.x,this.iTitle.y=this.iSPY.y+this.iTitle.height+30,this.lanternIcon=this.createBitmapByName("lantern_active"),this.decoContainer.addChild(this.lanternIcon),this.lanternIcon.touchEnabled=!0,this.lanternIcon.x=Window.CurrentStage.stage.stageWidth*(1/this.gameScale)-200-this.lanternIcon.width,this.lanternIcon.y=Window.CurrentStage.stage.stageHeight,this.lanternIcon.anchorOffsetX=.5,this.lanternIcon.anchorOffsetY=.5,this.lanternIcon.scaleX=2,this.lanternIcon.scaleY=2,this.lanternIcon.z=1e3,this.lanternIcon.state="ready",this.lanternIcon.counter=0,this.lanternIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){"ready"==t.lanternIcon.state&&(t.lanternIcon.state="cooling",t.lanternIcon.texture=RES.getRes("lantern_spent"),t.lanternStatus.text="Cooling",t.player.state="attacking",t.player.lanternCount=0)},this);this.lanternStatus=new egret.TextField,this.decoContainer.addChild(this.lanternStatus),this.lanternStatus.text="Ready!",this.lanternStatus.textColor="0xffffff",this.lanternStatus.x=this.lanternIcon.x+this.lanternIcon.width/2+this.lanternStatus.width/2-50,this.lanternStatus.y=this.lanternIcon.y-20,this.lanternStatus.z=1e3,this.ghost.alpha=0}"people"==window.playerType&&(this.CreateRoom(100+this.roundRandom(0,2)*this.roomWidth,this.levelHeights[0],this.roundRandom(0,3),"Attic",null),this.CreateRoom(100+this.roundRandom(0,3)*this.roomWidth,this.levelHeights[1],this.roundRandom(3,4),"Middle",null),this.CreateRoom(100+this.roundRandom(0,3)*this.roomWidth,this.levelHeights[2],this.roundRandom(3,4),"Middle",null),this.CreateRoom(100+this.roundRandom(1,4)*this.roomWidth,this.levelHeights[3],this.roundRandom(0,2),"Basement",null),this.player.x=this.roomArray[0].pieces[0].x,this.player.y=this.roomArray[0].pieces[0].y-200),this.scaleX=this.scaleY=this.gameScale,"ghost"==window.playerType},e.prototype.update=function(){if(this.readyCounter--,this.readyCounter>0&&(this.countdownGraphic.texture=RES.getRes("countdown_"+String(Math.round(this.readyCounter/60)))),this.readyCounter<0&&(this.blackness.alpha=0,this.creditText.alpha=0,this.countdownGraphic.alpha=0,this.iTitle.alpha=0,this.iSPY.alpha=0),"people"==window.playerType){this.player.speedY++,this.player.y+=this.player.speedY,this.player.speedY>10&&(this.player.speedY=10);"attacking"!=this.player.state&&("LEFT"==this.player.behavior&&(this.player.speedX--,"idle"==this.player.state&&(this.player.state="walking"),this.player.scaleX=1,this.leftOrRight=!0),"RIGHT"==this.player.behavior&&(this.player.speedX++,"idle"==this.player.state&&(this.player.state="walking"),this.player.scaleX=1,this.leftOrRight=!0),"DOWN"==this.player.behavior&&"jumping"!=this.player.state&&(this.player.state="jumping",this.player.slip=20),"UP"==this.player.behavior&&"jumping"!=this.player.state&&(this.player.state="jumping",this.player.speedY=-22)),"cooling"==this.lanternIcon.state&&(this.lanternIcon.counter++,this.lanternIcon.counter>300&&(this.lanternIcon.counter=0,this.lanternIcon.state="ready",this.lanternIcon.texture=RES.getRes("lantern_active"),this.lanternStatus.text="Ready!")),"walking"==this.player.state&&("run"!=this.player.frameTitle&&(this.player.frameTitle="run",this.player.frameNum=1),this.player.texture=RES.getRes("kid_run"+this.player.frameNum),this.leftOrRight||(this.player.state="idle")),"idle"==this.player.state&&"idle"!=this.player.frameTitle&&(this.player.texture=RES.getRes("kid_idle"),this.player.frameTitle="idle",this.player.frameNum=1),"jumping"==this.player.state&&(this.player.speedY<0?(this.player.texture=RES.getRes("kid_air_jump"),this.player.frameTitle="air_jump"):(this.player.texture=RES.getRes("kid_air_fall"),this.player.frameTitle="air_fall")),"attacking"==this.player.state&&(this.player.frameNum=1,this.player.frameTitle="lantern",this.player.texture=RES.getRes("kid_lantern"),this.player.lanternCount++,this.player.attachedLantern.alpha=1,this.player.glow.alpha=1,this.player.glow.x=this.player.x-this.player.glow.width/2+this.player.width/2,this.player.glow.y=this.player.y-this.player.glow.height/2,this.player.attachedLantern.x=this.player.x,this.player.attachedLantern.y=this.player.y-this.player.height/2-this.player.attachedLantern.height/2,window.ConnObject&&window.ConnObject.send({isLight:!0,x:this.player.x,y:this.player.y,r:this.player.glow.width/2}),this.player.lanternCount>60&&(this.player.state="idle",this.player.attachedLantern.alpha=0,this.player.glow.alpha=0)),this.player.counter++,this.player.counter>3&&(this.player.counter=0,this.player.frameNum++,this.player.frameNum>this.player.frameCounts[this.player.frameTitle]&&(this.player.frameNum=1)),this.player.x+=this.player.speedX,this.player.speedX*=.86,this.player.slip<0&&this.FloorCollision(this.player),this.player.slip--,this.player.x+=this.worldMoveSpeed,this.player.broadcastCount++,this.player.broadcastCount>this.player.broadcastTime&&(this.player.broadcastCount=0,window.ConnObject&&window.ConnObject.send({meta:"p_xy",x:this.player.x,y:this.player.y}));for(var t=window.messageQ.length-1;t>=0;t--){var e=window.messageQ[t],r=!1;"g_mv"==e.meta&&(this.ghost.x=e.x,this.ghost.y=e.y,this.ghost.target={x:e.tx,y:e.ty},this.ghost.alpha=1,r=!0),"g_dp"==e.meta&&(this.CreateDrop(e.x,e.y,e.asset),r=!0),e.isWin&&(window.winner=e.winner,r=!0),r&&window.messageQ.splice(t,1)}this.ghost.alpha>0&&(this.ghost.alpha-=.1)}if("ghost"==window.playerType){this.ghost.glowCount<=0&&(this.player.attachedLantern.alpha=0,this.player.glow.alpha=0,this.player.texture=RES.getRes("kid_idle")),this.ghost.glowCount--;for(var t=window.messageQ.length-1;t>=0;t--){var e=window.messageQ[t],r=!1;if(e.isWin&&(window.winner=e.winner,r=!0),"p_xy"==e.meta&&(this.player.x=e.x,this.player.y=e.y,this.player.alpha=1,r=!0),e.isLight){var i=this.ghost.x-e.x,a=this.ghost.y-e.y,n=e.r,o=Math.sqrt(i*i+a*a);this.player.alpha=1,this.player.x=e.x,this.player.y=e.y,this.player.attachedLantern.alpha=1,this.player.glow.alpha=1,this.player.glow.x=this.player.x,this.player.glow.y=this.player.y,this.player.texture=RES.getRes("kid_lantern"),this.player.attachedLantern.x=this.player.x,this.player.attachedLantern.y=this.player.y-this.player.height/2-this.player.attachedLantern.height/2,n>=o&&(window.winner="Player"),this.ghost.glowCount=20,r=!0}e.is_p_room&&(this.CreateRoom(e.x,e.y,e.width,e.level,e.decoArray),r=!0),r&&window.messageQ.splice(t,1)}this.player.alpha>0&&(this.player.alpha-=1/30)}for(var t=0;t<this.dropArray.length;t++){var s=this.dropArray[t];s.speedY++,s.speedY>20&&(s.speedY=20),s.y+=s.speedY,"people"==window.playerType&&this.checkOverlap(s,this.player)&&(window.winner="Ghost",console.log("Death 3"))}if(this.ghost.counter++,this.ghost.counter>3&&(this.ghost.counter=0,this.ghost.frameNum++,this.ghost.frameNum>8&&(this.ghost.frameNum=1),this.ghost.texture=RES.getRes("ghost_float"+this.ghost.frameNum)),this.ghost.target){this.ghost.x+=(this.ghost.target.x-this.ghost.x)/16,this.ghost.y+=(this.ghost.target.y-this.ghost.y)/16;var i=this.ghost.target.x-this.ghost.x,a=this.ghost.target.y-this.ghost.y,o=Math.sqrt(i*i+a*a);10>o&&(this.ghost.target=null)}if("people"==window.playerType)for(var t=0;t<this.roomArray.length;t++){var h=this.roomArray[t],l=h.floor[0].x-h.floor[0].width/2,d=h.floor[h.floor.length-1].x+h.floor[h.floor.length-1].width;if(!h.nextCreated&&l<Window.CurrentStage.stage.stageWidth*(1/this.gameScale)){h.nextCreated=!0;var c="",p=1,u=3,g=0,f=4;h.pieces[0].y==this.levelHeights[0]&&(c="Attic",g=0,f=2),(h.pieces[0].y==this.levelHeights[1]||h.pieces[0].y==this.levelHeights[2])&&(c="Middle",p=1,u=2,g=3,f=4),h.pieces[0].y==this.levelHeights[3]&&(c="Basement",g=1,f=2);var y=h.pieces[0].y;this.CreateRoom(d+this.roomWidth*this.roundRandom(p,u),y,this.roundRandom(g,f),c,null)}}for(var t=this.roomArray.length-1;t>=0;t--){for(var h=this.roomArray[t],w=0;w<h.floor.length;w++)h.floor[w].x+=this.worldMoveSpeed;for(var w=0;w<h.pieces.length;w++)h.pieces[w].x+=this.worldMoveSpeed;for(var w=0;w<h.deco.length;w++)h.deco[w].x+=this.worldMoveSpeed;var m=h.floor[h.floor.length-1];m.width*h.floor.length;if(m.x+m.width/2<-100){for(var w=0;w<h.floor.length;w++)this.roomContainer.removeChild(h.floor[w]);for(var w=0;w<h.pieces.length;w++)this.roomContainer.removeChild(h.pieces[w]);for(var w=0;w<h.deco.length;w++)this.roomContainer.removeChild(h.deco[w]);this.roomArray.splice(t,1)}}},e.prototype.SendTargetData=function(t,e){if("ghost"==window.playerType){var r=t-this.ghost.x,i=e-this.ghost.y,a=Math.sqrt(r*r+i*i);if(this.ghost.scaleX=Math.abs(r)/r,75>a){var n=this.CreateDrop(this.ghost.x,this.ghost.y,null);window.ConnObject&&window.ConnObject.send({meta:"g_dp",x:this.ghost.x,y:this.ghost.y,asset:n.asset})}else egret.Tween.get(this.ghost).to({x:t-this.ghost.width/2,y:e-this.ghost.height/2},300,egret.Ease.sineIn),window.ConnObject&&window.ConnObject.send({meta:"g_mv",tx:t,ty:e,x:this.ghost.x,y:this.ghost.y})}},e.prototype.childrenCreated=function(){this.vj.start(),this.vj.addEventListener("vj_move",this.onChange,this),this.vj.addEventListener("vj_end",this.onEnd,this)},e.prototype.onStart=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.onEnterFrame,this)},e.prototype.onChange=function(t){var e=t.data;"people"==window.playerType,e>-.75&&.75>e?this.player.behavior="RIGHT":e>.75&&2.75>e?this.player.behavior="DOWN":e>2.75||-2.75>e?this.player.behavior="LEFT":this.player.behavior="UP"},e.prototype.onEnd=function(){this.player.behavior="none",this.leftOrRight=!1},e.prototype.onEnterFrame=function(){this.player.x+=this.player.speedX,this.player.y+=this.player.speedY},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(Gameplay.prototype,"Gameplay");var LoadingState=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){var t=new egret.Shape;t.graphics.beginFill(1183260,1),t.graphics.drawRect(0,0,700,500),t.graphics.endFill(),this.addChild(t),this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=700,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingState.prototype,"LoadingState",["RES.PromiseTaskReporter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){var t=new egret.Shape;t.graphics.beginFill(1183260,1),t.graphics.drawRect(0,0,700,500),t.graphics.endFill(),this.addChild(t),this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=700,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return Window.CurrentStage=this,[4,this.loadResource()];case 1:return t.sent(),[4,this.WarningState()];case 2:return t.sent(),[2]}})})},e.prototype.WarningState=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){try{t=new Warning,Window.CurrentView=t,this.stage.addChild(t)}catch(r){console.error(r)}return[2]})})},e.prototype.MenuState=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){try{this.stage.removeChild(t),e=new Menu,Window.CurrentView=e,this.stage.addChild(e)}catch(i){console.error(i)}return[2]})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),t=new LoadingState,this.stage.addChild(t),Window.CurrentView=t,[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return r.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return r.sent(),this.stage.removeChild(t),[3,4];case 3:return e=r.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,r=this.stage.stageHeight;t.width=e,t.height=r;var i=new egret.Shape;i.graphics.beginFill(0,.5),i.graphics.drawRect(0,0,e,172),i.graphics.endFill(),i.y=33,this.addChild(i);var a=this.createBitmapByName("egret_icon_png");this.addChild(a),a.x=26,a.y=33;var n=new egret.Shape;n.graphics.lineStyle(2,16777215),n.graphics.moveTo(0,0),n.graphics.lineTo(0,117),n.graphics.endFill(),n.x=172,n.y=61,this.addChild(n);var o=new egret.TextField;o.textColor=16777215,o.width=e-172,o.textAlign="center",o.text="Hello Egret",o.size=24,o.x=172,o.y=80,this.addChild(o);var s=new egret.TextField;this.addChild(s),s.alpha=0,s.width=e-172,s.textAlign=egret.HorizontalAlign.CENTER,s.size=24,s.textColor=16777215,s.x=172,s.y=135,this.textfield=s},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,r=RES.getRes(t);return e.texture=r,e},e.prototype.startAnimation=function(t){var e=this,r=new egret.HtmlTextParser,i=t.map(function(t){return r.parse(t)}),a=this.textfield,n=-1,o=function(){n++,n>=i.length&&(n=0);var t=i[n];a.textFlow=t;var r=egret.Tween.get(a);r.to({alpha:1},200),r.wait(2e3),r.to({alpha:0},200),r.call(o,e)};o()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Menu=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,r=RES.getRes(t);return e.texture=r,e},e.prototype.createView=function(){if(""==location.search){var t=new egret.Shape;t.graphics.beginFill(1183260,1),t.graphics.drawRect(0,0,700,500),t.graphics.endFill(),this.addChild(t);var e=this.createBitmapByName("textbox_code_mobile");this.addChild(e),e.anchorOffsetX=.5,e.anchorOffsetY=.5,e.x=Window.CurrentStage.stage.stageWidth/2,e.y=Window.CurrentStage.stage.stageHeight/2-70;var r=new egret.TextField;this.addChild(r),r.text="你的房间号",r.y=425,r.x=e.x-r.width/2;var i=({font:"70px patagoniaregular",fill:window.numberColor,align:"center"},qr.QRCode.create(window.host+"?id="+window.peerId,300,300,16777215));console.log(window.host+"?id="+window.peerId),i.x=e.x-i.width/2,i.y=100,this.addChild(i);var a=new egret.TextField;this.addChild(a),a.text="请分享给朋友，等待朋友进入游戏",a.textColor=16777215,a.x=Window.CurrentStage.stage.stageWidth-a.width/2,a.y=Window.CurrentStage.stage.stageHeight,window.wx&&window.wx.onShareAppMessage(function(){return{query:"ID:"+window.PeerObject.id}}),window.PeerObject.on("connection",function(t){window.ConnObject=t,window.ConnObject.on("data",function(t){window.messageQ.push(t)}),window.playerType="ghost",Window.CurrentStage.stage.removeChild(Window.CurrentView);var e=new Gameplay;Window.CurrentView=e,Window.CurrentStage.stage.addChild(e)})}else window.ConnObject=window.PeerObject.connect(location.search.split("id=")[1]),window.ConnObject.on("open",function(){console.log("Sending Connect"),window.ConnObject.send("connect"),window.playerType="people",window.ConnObject.on("data",function(t){window.messageQ.push(t)}),Window.CurrentStage.stage.removeChild(Window.CurrentView);var t=new Gameplay;Window.CurrentView=t,Window.CurrentStage.stage.addChild(t)})},e}(egret.Sprite);__reflect(Menu.prototype,"Menu");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.showShareMenu=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.share=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var VirtualJoystick=function(t){function e(){var e=t.call(this)||this;return e.circleRadius=0,e.ballRadius=0,e.centerX=0,e.centerY=0,e.p1=new egret.Point,e.p2=new egret.Point,e.skinName="VirtualJoystickSkin",e.ball=e.createBitmapByName("ball_png"),e.addChild(e.ball),e.circle=e.createBitmapByName("circle_png"),e.addChild(e.circle),e.GameConst=Window.CurrentStage,e.childrenCreated(),e}return __extends(e,t),e.prototype.childrenCreated=function(){this.circleRadius=this.circle.height/2,this.ballRadius=this.ball.height/2,this.centerX=this.circleRadius,this.centerY=this.circleRadius,this.anchorOffsetX=this.circleRadius,this.anchorOffsetY=this.circleRadius,this.ball.x=this.centerX,this.ball.y=this.centerY},e.prototype.start=function(){this.GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.GameConst.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)},e.prototype.stop=function(){this.GameConst.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.GameConst.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.GameConst.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)},e.prototype.onTouchBegin=function(t){t.stageX>Window.CurrentStage.stage.stageWidth/2||this.parent||(this.touchID=t.touchPointID,this.x=t.stageX,this.y=t.stageY,this.ball.x=this.centerX,this.ball.y=this.centerY,this.GameConst.stage.addChild(this),this.dispatchEvent(new egret.Event("vj_start")))},e.prototype.onTouchEnd=function(t){this.touchID==t.touchPointID&&(this.hide(),this.dispatchEvent(new egret.Event("vj_end")))},e.prototype.onTouchMove=function(t){if(this.touchID==t.touchPointID){this.p1.x=this.x,this.p1.y=this.y,this.p2.x=t.stageX,this.p2.y=t.stageY;var e=egret.Point.distance(this.p1,this.p2),r=Math.atan2(t.stageY-this.y,t.stageX-this.x);e<=this.circleRadius-this.ballRadius?(this.ball.x=this.centerX+t.stageX-this.x,this.ball.y=this.centerY+t.stageY-this.y):(this.ball.x=Math.cos(r)*(this.circleRadius-this.ballRadius)+this.centerX-this.ball.width/2,this.ball.y=Math.sin(r)*(this.circleRadius-this.ballRadius)+this.centerY-this.ball.height/2),t.stageX>Window.CurrentStage.stage.stageWidth/2||this.dispatchEventWith("vj_move",!1,r)}},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,r=RES.getRes(t);return e.texture=r,e},e.prototype.hide=function(){this.parent&&this.parent.removeChild(this)},e}(eui.Component);__reflect(VirtualJoystick.prototype,"VirtualJoystick");var Warning=function(t){function e(){var e=t.call(this)||this;return e.createView(),e.addEventListener(egret.Event.ENTER_FRAME,function(){e.update()},e),e}return __extends(e,t),e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,r=RES.getRes(t);return e.texture=r,e},e.prototype.makeid=function(){for(var t="",e="abcdefghijklmnopqrstuvwxyz0123456789",r=0;6>r;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t},e.prototype.createView=function(){var t=this,e=new egret.Shape;e.graphics.beginFill(2299699,1),e.graphics.drawRect(0,0,700,500),e.graphics.endFill(),this.addChild(e),this.warningScreen=this.createBitmapByName("multiplayer");var r=this.warningScreen;this.addChild(r),r.x=Window.CurrentStage.stage.stageWidth/2-r.width/2,r.y=Window.CurrentStage.stage.stageHeight/2-r.height/2,r.y-=60,r.anchorOffsetX=.5,r.anchorOffsetY=.5,r.state="fadein",r.alpha=0,r.counter=0,this.txtboxScreen=this.createBitmapByName("textbox_large");var i=this.txtboxScreen;this.addChild(i),i.y=Window.CurrentStage.stage.stageHeight/2-i.height/2,i.y+=i.width/2-70,i.x=Window.CurrentStage.stage.stageWidth/2-i.width/2,i.anchorOffsetX=.5,i.anchorOffsetY=.5,i.alpha=0,this.textField=new egret.TextField,this.addChild(this.textField),this.textField.x=i.x+30,this.textField.y=i.y+30,this.textField.textColor=window.numberColor,this.textField.width=380,this.textField.textAlign="center",this.textField.text="这是一款双人游戏。最好是用移动设备或电脑来玩。",window.PeerObject=new window.Peer(this.makeid(),{host:"75.75.226.250",port:9e3,path:"/"}),window.PeerObject.on("open",function(t){window.peerId=t,e.touchEnabled=!0,console.log("ID: "+t)}),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t["switch"]()},this),window.PeerObject.on("error",function(t){"unavailable-id"===t.type?window.PeerObject.reconnect():alert(""+t)})},e.prototype.update=function(){"fadein"==this.warningScreen.state&&(this.warningScreen.alpha<1&&(this.warningScreen.alpha+=.02),this.warningScreen.counter++,this.warningScreen.counter>300&&(this.warningScreen.state="fadeout")),"fadeout"==this.warningScreen.state&&(this.warningScreen.alpha>0&&(this.warningScreen.alpha-=.02),this.warningScreen.alpha<=0&&this["switch"]()),this.txtboxScreen.alpha=this.warningScreen.alpha,this.textField.alpha=this.warningScreen.alpha
},e.prototype["switch"]=function(){Window.CurrentStage.stage.removeChild(Window.CurrentView);var t=new Menu;Window.CurrentView=t,Window.CurrentStage.stage.addChild(t)},e}(egret.Stage);__reflect(Warning.prototype,"Warning");var GameOverState=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(GameOverState.prototype,"GameOverState",["RES.PromiseTaskReporter"]);var qr;!function(t){var e=function(){function t(){this.buffer=[],this.length=0}return t.prototype.get=function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},t.prototype.put=function(t,e){for(var r=0;e>r;r++)this.putBit(1==(t>>>e-r-1&1))},t.prototype.getLengthInBits=function(){return this.length},t.prototype.putBit=function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++},t}();t.QRBitBuffer=e,__reflect(e.prototype,"qr.QRBitBuffer")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(){}return e.create=function(r,i,a,n,o){void 0===i&&(i=200),void 0===a&&(a=200),void 0===n&&(n=0),void 0===o&&(o=2);var s={width:i,height:a,correctLevel:t.QRErrorCorrectLevel.H,color:n},h=new t.QRCodeModel(t.QRUtil._getTypeNumber(r,s.correctLevel),s.correctLevel);return h.addData(r),h.make(),e.draw(h,s)},e.draw=function(t,e){var r=new egret.Sprite,e=e,i=t.getModuleCount(),a=Math.floor(e.width/i),n=Math.floor(e.height/i);r.graphics.beginFill(e.color);for(var o=0;i>o;o++)for(var s=0;i>s;s++){var h=t.isDark(o,s);h&&r.graphics.drawRect(s*a,o*n,a,n)}return r.graphics.endFill(),r},e}();t.QRCode=e,__reflect(e.prototype,"qr.QRCode")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(t,e){this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[],this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}return e.prototype.addData=function(e){var r=new t.QR8bitByte(e);this.dataList.push(r),this.dataCache=null},e.prototype.isDark=function(t,e){if(0>t||this.moduleCount<=t||0>e||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},e.prototype.getModuleCount=function(){return this.moduleCount},e.prototype.make=function(){this.makeImpl(!1,this.getBestMaskPattern())},e.prototype.makeImpl=function(t,r){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++){this.modules[i]=new Array(this.moduleCount);for(var a=0;a<this.moduleCount;a++)this.modules[i][a]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,r),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,r)},e.prototype.setupPositionProbePattern=function(t,e){for(var r=-1;7>=r;r++)if(!(-1>=t+r||this.moduleCount<=t+r))for(var i=-1;7>=i;i++)-1>=e+i||this.moduleCount<=e+i||(r>=0&&6>=r&&(0==i||6==i)||i>=0&&6>=i&&(0==r||6==r)||r>=2&&4>=r&&i>=2&&4>=i?this.modules[t+r][e+i]=!0:this.modules[t+r][e+i]=!1)},e.prototype.getBestMaskPattern=function(){for(var e=0,r=0,i=0;8>i;i++){this.makeImpl(!0,i);var a=t.QRUtil.getLostPoint(this);(0==i||e>a)&&(e=a,r=i)}return r},e.prototype.createMovieClip=function(t,e,r){var i=t.createEmptyMovieClip(e,r),a=1;this.make();for(var n=0;n<this.modules.length;n++)for(var o=n*a,s=0;s<this.modules[n].length;s++){var h=s*a,l=this.modules[n][s];l&&(i.beginFill(0,100),i.moveTo(h,o),i.lineTo(h+a,o),i.lineTo(h+a,o+a),i.lineTo(h,o+a),i.endFill())}return i},e.prototype.setupTimingPattern=function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},e.prototype.setupPositionAdjustPattern=function(){for(var e=t.QRUtil.getPatternPosition(this.typeNumber),r=0;r<e.length;r++)for(var i=0;i<e.length;i++){var a=e[r],n=e[i];if(null==this.modules[a][n])for(var o=-2;2>=o;o++)for(var s=-2;2>=s;s++)-2==o||2==o||-2==s||2==s||0==o&&0==s?this.modules[a+o][n+s]=!0:this.modules[a+o][n+s]=!1}},e.prototype.setupTypeNumber=function(e){for(var r=t.QRUtil.getBCHTypeNumber(this.typeNumber),i=0;18>i;i++){var a=!e&&1==(r>>i&1);this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=a}for(var i=0;18>i;i++){var a=!e&&1==(r>>i&1);this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=a}},e.prototype.setupTypeInfo=function(e,r){for(var i=this.errorCorrectLevel<<3|r,a=t.QRUtil.getBCHTypeInfo(i),n=0;15>n;n++){var o=!e&&1==(a>>n&1);6>n?this.modules[n][8]=o:8>n?this.modules[n+1][8]=o:this.modules[this.moduleCount-15+n][8]=o}for(var n=0;15>n;n++){var o=!e&&1==(a>>n&1);8>n?this.modules[8][this.moduleCount-n-1]=o:9>n?this.modules[8][15-n-1+1]=o:this.modules[8][15-n-1]=o}this.modules[this.moduleCount-8][8]=!e},e.prototype.mapData=function(e,r){for(var i=-1,a=this.moduleCount-1,n=7,o=0,s=this.moduleCount-1;s>0;s-=2)for(6==s&&s--;;){for(var h=0;2>h;h++)if(null==this.modules[a][s-h]){var l=!1;o<e.length&&(l=1==(e[o]>>>n&1));var d=t.QRUtil.getMask(r,a,s-h);d&&(l=!l),this.modules[a][s-h]=l,n--,-1==n&&(o++,n=7)}if(a+=i,0>a||this.moduleCount<=a){a-=i,i=-i;break}}},e.createData=function(r,i,a){for(var n=t.QRRSBlock.getRSBlocks(r,i),o=new t.QRBitBuffer,s=0;s<a.length;s++){var h=a[s];o.put(h.mode,4),o.put(h.getLength(),t.QRUtil.getLengthInBits(h.mode,r)),h.write(o)}for(var l=0,s=0;s<n.length;s++)l+=n[s].dataCount;if(o.getLengthInBits()>8*l)throw new Error("code length overflow. ("+o.getLengthInBits()+">"+8*l+")");for(o.getLengthInBits()+4<=8*l&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(!1);for(;!(o.getLengthInBits()>=8*l)&&(o.put(e.PAD0,8),!(o.getLengthInBits()>=8*l));)o.put(e.PAD1,8);return e.createBytes(o,n)},e.createBytes=function(e,r){for(var i=0,a=0,n=0,o=new Array(r.length),s=new Array(r.length),h=0;h<r.length;h++){var l=r[h].dataCount,d=r[h].totalCount-l;a=Math.max(a,l),n=Math.max(n,d),o[h]=new Array(l);for(var c=0;c<o[h].length;c++)o[h][c]=255&e.buffer[c+i];i+=l;var p=t.QRUtil.getErrorCorrectPolynomial(d),u=new t.QRPolynomial(o[h],p.getLength()-1),g=u.mod(p);s[h]=new Array(p.getLength()-1);for(var c=0;c<s[h].length;c++){var f=c+g.getLength()-s[h].length;s[h][c]=f>=0?g.get(f):0}}for(var y=0,c=0;c<r.length;c++)y+=r[c].totalCount;for(var w=new Array(y),m=0,c=0;a>c;c++)for(var h=0;h<r.length;h++)c<o[h].length&&(w[m++]=o[h][c]);for(var c=0;n>c;c++)for(var h=0;h<r.length;h++)c<s[h].length&&(w[m++]=s[h][c]);return w},e.PAD0=236,e.PAD1=17,e}();t.QRCodeModel=e,__reflect(e.prototype,"qr.QRCodeModel")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t.L=1,t.M=0,t.Q=3,t.H=2,t}();t.QRErrorCorrectLevel=e,__reflect(e.prototype,"qr.QRErrorCorrectLevel")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t.PATTERN000=0,t.PATTERN001=1,t.PATTERN010=2,t.PATTERN011=3,t.PATTERN100=4,t.PATTERN101=5,t.PATTERN110=6,t.PATTERN111=7,t}();t.QRMaskPattern=e,__reflect(e.prototype,"qr.QRMaskPattern")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t.glog=function(e){return t.isInit||t.init(),1>e&&console.log("错误:n="+e),t.LOG_TABLE[e]},t.gexp=function(e){for(t.isInit||t.init();0>e;)e+=255;for(;e>=256;)e-=255;return t.EXP_TABLE[e]},t.init=function(){t.isInit=!0;for(var e=0;8>e;e++)t.EXP_TABLE[e]=1<<e;for(var e=8;256>e;e++)t.EXP_TABLE[e]=t.EXP_TABLE[e-4]^t.EXP_TABLE[e-5]^t.EXP_TABLE[e-6]^t.EXP_TABLE[e-8];for(var e=0;255>e;e++)t.LOG_TABLE[t.EXP_TABLE[e]]=e},t.EXP_TABLE=new Array(256),t.LOG_TABLE=new Array(256),t}();t.QRMath=e,__reflect(e.prototype,"qr.QRMath")}(qr||(qr={}));var qr;!function(t){var e=function(){function t(){}return t.MODE_NUMBER=1,t.MODE_ALPHA_NUM=2,t.MODE_8BIT_BYTE=4,t.MODE_KANJI=8,t}();t.QRMode=e,__reflect(e.prototype,"qr.QRMode")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(t,e){if(void 0==t.length)throw new Error(t.length+"/"+e);for(var r=0;r<t.length&&0==t[r];)r++;this.num=new Array(t.length-r+e);for(var i=0;i<t.length-r;i++)this.num[i]=t[i+r]}return e.prototype.get=function(t){return this.num[t]},e.prototype.getLength=function(){return this.num.length},e.prototype.multiply=function(r){for(var i=new Array(this.getLength()+r.getLength()-1),a=0;a<this.getLength();a++)for(var n=0;n<r.getLength();n++)i[a+n]^=t.QRMath.gexp(t.QRMath.glog(this.get(a))+t.QRMath.glog(r.get(n)));return new e(i,0)},e.prototype.mod=function(r){if(this.getLength()-r.getLength()<0)return this;for(var i=t.QRMath.glog(this.get(0))-t.QRMath.glog(r.get(0)),a=new Array(this.getLength()),n=0;n<this.getLength();n++)a[n]=this.get(n);for(var n=0;n<r.getLength();n++)a[n]^=t.QRMath.gexp(t.QRMath.glog(r.get(n))+i);return new e(a,0).mod(r)},e}();t.QRPolynomial=e,__reflect(e.prototype,"qr.QRPolynomial")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(t,e){this.totalCount=t,this.dataCount=e}return e.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],e.getRSBlocks=function(t,r){var i=e.getRsBlockTable(t,r);if(void 0==i)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+r);for(var a=i.length/3,n=[],o=0;a>o;o++)for(var s=i[3*o+0],h=i[3*o+1],l=i[3*o+2],d=0;s>d;d++)n.push(new e(h,l));return n},e.getRsBlockTable=function(r,i){switch(i){case t.QRErrorCorrectLevel.L:return e.RS_BLOCK_TABLE[4*(r-1)+0];case t.QRErrorCorrectLevel.M:return e.RS_BLOCK_TABLE[4*(r-1)+1];case t.QRErrorCorrectLevel.Q:return e.RS_BLOCK_TABLE[4*(r-1)+2];case t.QRErrorCorrectLevel.H:return e.RS_BLOCK_TABLE[4*(r-1)+3];default:return}},e}();t.QRRSBlock=e,__reflect(e.prototype,"qr.QRRSBlock")}(qr||(qr={}));var qr;!function(t){var e=function(){function e(){}return e.getBCHTypeInfo=function(t){for(var r=t<<10;e.getBCHDigit(r)-e.getBCHDigit(e.G15)>=0;)r^=e.G15<<e.getBCHDigit(r)-e.getBCHDigit(e.G15);return(t<<10|r)^e.G15_MASK},e.getBCHTypeNumber=function(t){for(var r=t<<12;e.getBCHDigit(r)-e.getBCHDigit(e.G18)>=0;)r^=e.G18<<e.getBCHDigit(r)-e.getBCHDigit(e.G18);return t<<12|r},e.getBCHDigit=function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},e.getPatternPosition=function(t){return e.PATTERN_POSITION_TABLE[t-1]},e.getMask=function(e,r,i){switch(e){case t.QRMaskPattern.PATTERN000:return(r+i)%2==0;case t.QRMaskPattern.PATTERN001:return r%2==0;case t.QRMaskPattern.PATTERN010:return i%3==0;case t.QRMaskPattern.PATTERN011:return(r+i)%3==0;case t.QRMaskPattern.PATTERN100:return(Math.floor(r/2)+Math.floor(i/3))%2==0;case t.QRMaskPattern.PATTERN101:return r*i%2+r*i%3==0;case t.QRMaskPattern.PATTERN110:return(r*i%2+r*i%3)%2==0;case t.QRMaskPattern.PATTERN111:return(r*i%3+(r+i)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},e.getErrorCorrectPolynomial=function(e){for(var r=new t.QRPolynomial([1],0),i=0;e>i;i++)r=r.multiply(new t.QRPolynomial([1,t.QRMath.gexp(i)],0));return r},e.getLengthInBits=function(e,r){if(r>=1&&10>r)switch(e){case t.QRMode.MODE_NUMBER:return 10;case t.QRMode.MODE_ALPHA_NUM:return 9;case t.QRMode.MODE_8BIT_BYTE:return 8;case t.QRMode.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(27>r)switch(e){case t.QRMode.MODE_NUMBER:return 12;case t.QRMode.MODE_ALPHA_NUM:return 11;case t.QRMode.MODE_8BIT_BYTE:return 16;case t.QRMode.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(41>r))throw new Error("type:"+r);switch(e){case t.QRMode.MODE_NUMBER:return 14;case t.QRMode.MODE_ALPHA_NUM:return 13;case t.QRMode.MODE_8BIT_BYTE:return 16;case t.QRMode.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},e.getLostPoint=function(t){for(var e=t.getModuleCount(),r=0,i=0;e>i;i++)for(var a=0;e>a;a++){for(var n=0,o=t.isDark(i,a),s=-1;1>=s;s++)if(!(0>i+s||i+s>=e))for(var h=-1;1>=h;h++)0>a+h||a+h>=e||(0!=s||0!=h)&&o==t.isDark(i+s,a+h)&&n++;n>5&&(r+=3+n-5)}for(var i=0;e-1>i;i++)for(var a=0;e-1>a;a++){var l=0;t.isDark(i,a)&&l++,t.isDark(i+1,a)&&l++,t.isDark(i,a+1)&&l++,t.isDark(i+1,a+1)&&l++,(0==l||4==l)&&(r+=3)}for(var i=0;e>i;i++)for(var a=0;e-6>a;a++)t.isDark(i,a)&&!t.isDark(i,a+1)&&t.isDark(i,a+2)&&t.isDark(i,a+3)&&t.isDark(i,a+4)&&!t.isDark(i,a+5)&&t.isDark(i,a+6)&&(r+=40);for(var a=0;e>a;a++)for(var i=0;e-6>i;i++)t.isDark(i,a)&&!t.isDark(i+1,a)&&t.isDark(i+2,a)&&t.isDark(i+3,a)&&t.isDark(i+4,a)&&!t.isDark(i+5,a)&&t.isDark(i+6,a)&&(r+=40);for(var d=0,a=0;e>a;a++)for(var i=0;e>i;i++)t.isDark(i,a)&&d++;var c=Math.abs(100*d/e/e-50)/5;return r+=10*c},e.prototype.static_isSupportCanvas=function(){return"undefined"!=typeof CanvasRenderingContext2D},e._getTypeNumber=function(r,i){for(var a=1,n=e._getUTF8Length(r),o=0,s=e.QRCodeLimitLength.length;s>=o;o++){var h=0;switch(i){case t.QRErrorCorrectLevel.L:h=e.QRCodeLimitLength[o][0];break;case t.QRErrorCorrectLevel.M:h=e.QRCodeLimitLength[o][1];break;case t.QRErrorCorrectLevel.Q:h=e.QRCodeLimitLength[o][2];break;case t.QRErrorCorrectLevel.H:h=e.QRCodeLimitLength[o][3]}if(h>=n)break;a++}if(a>e.QRCodeLimitLength.length)throw new Error("Too long data");return a},e._getUTF8Length=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)},e.PATTERN_POSITION_TABLE=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],e.G15=1335,e.G18=7973,e.G15_MASK=21522,e.QRCodeLimitLength=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],e}();t.QRUtil=e,__reflect(e.prototype,"qr.QRUtil")}(qr||(qr={}));